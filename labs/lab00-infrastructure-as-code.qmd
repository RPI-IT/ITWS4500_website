---
title: "Lab 0: Infrastructure as Code"
subtitle: "Building a MERN Stack with Docker Compose"
---

::: {.callout-important}
## Lab Information
**Assigned:** Tuesday, January 20, 2026
**Due:** Tuesday, January 27, 2026 (before class)
**Points:** 100
:::

## Overview

In this lab, you will create a complete MERN (MongoDB, Express, React, Node.js) development environment using Docker and Docker Compose. This foundational setup will be used throughout the semester and demonstrates Infrastructure as Code principles.

## Learning Objectives

By completing this lab, you will:

1. Create production-ready **Dockerfiles** for Node.js applications
2. Configure **Docker Compose** for multi-service orchestration
3. Implement **volume mounting** for hot reload development
4. Understand **container networking** and service discovery
5. Practice **Infrastructure as Code** principles

## Prerequisites

Before starting, ensure you have:

- [ ] Docker Desktop installed and running
- [ ] Visual Studio Code (or preferred editor)
- [ ] Git installed
- [ ] Basic understanding of JavaScript/Node.js
- [ ] GitHub account

Verify your Docker installation:

```bash
docker --version
docker compose version
```

## Requirements

### Project Structure (10 points)

Create the following directory structure:

```
lab0-mern-stack/
├── docker-compose.yml
├── .env
├── .env.example
├── .gitignore
├── README.md
├── api/
│   ├── Dockerfile
│   ├── Dockerfile.dev
│   ├── package.json
│   ├── .dockerignore
│   └── src/
│       ├── server.js
│       ├── routes/
│       │   └── items.js
│       └── models/
│           └── Item.js
└── frontend/
    ├── Dockerfile
    ├── Dockerfile.dev
    ├── package.json
    ├── .dockerignore
    ├── vite.config.js (or equivalent)
    └── src/
        ├── App.jsx
        ├── index.jsx
        └── App.css
```

### Docker Compose Configuration (20 points)

Your `docker-compose.yml` must include:

1. **Frontend Service** (React)
   - Built from `Dockerfile.dev`
   - Port 3000 exposed
   - Source code mounted as volume
   - Environment variable for API URL

2. **API Service** (Express)
   - Built from `Dockerfile.dev`
   - Port 4000 exposed
   - Source code mounted as volume
   - Environment variables for MongoDB connection
   - Depends on MongoDB being healthy

3. **MongoDB Service**
   - Official MongoDB 7 image
   - Named volume for data persistence
   - Health check configured

4. **Mongo Express Service** (optional but recommended)
   - Official mongo-express image
   - Port 8081 exposed

### API Implementation (20 points)

The Express API must include:

1. **Health endpoint** (`GET /health`)
   - Returns status, timestamp, and uptime

2. **CRUD operations** for Items (`/api/items`)
   - `GET /` - List all items
   - `GET /:id` - Get single item
   - `POST /` - Create item
   - `PUT /:id` - Update item
   - `DELETE /:id` - Delete item

3. **Item Model** with fields:
   - `name` (required, string)
   - `description` (optional, string)
   - `completed` (boolean, default false)
   - `timestamps` (automatic)

4. **Error handling middleware**

### Frontend Implementation (20 points)

The React frontend must:

1. **Display items** from the API
2. **Add new items** via form
3. **Toggle completion** status
4. **Delete items**
5. **Handle loading states** and errors
6. **Style appropriately** (basic CSS is fine)

### Hot Reload (10 points)

Both services must support hot reload:

- API: Changes to `api/src/` automatically restart the server
- Frontend: Changes to `frontend/src/` automatically update the browser

### Data Persistence (10 points)

MongoDB data must persist across container restarts:

```bash
# Test persistence
docker compose down
docker compose up -d
# Data should still be there
```

### Documentation (10 points)

`README.md` must include:

1. Project description
2. Prerequisites
3. Setup instructions (step-by-step)
4. Environment variables explanation
5. How to run the project
6. How to test the endpoints
7. Screenshots of working application (at least 2)
8. Troubleshooting common issues

## Starter Code

### API package.json

```json
{
  "name": "mern-api",
  "version": "1.0.0",
  "main": "src/server.js",
  "scripts": {
    "start": "node src/server.js",
    "dev": "nodemon src/server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^8.0.0",
    "cors": "^2.8.5",
    "helmet": "^7.1.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.2"
  }
}
```

### API server.js (starter)

```javascript
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const helmet = require('helmet');

const app = express();
const PORT = process.env.PORT || 4000;

// Middleware
app.use(helmet());
app.use(cors());
app.use(express.json());

// Health check
app.get('/health', (req, res) => {
  res.json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  });
});

// TODO: Add routes

// TODO: Add error handling middleware

// Connect to MongoDB and start server
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    console.log('Connected to MongoDB');
    app.listen(PORT, '0.0.0.0', () => {
      console.log(`Server running on port ${PORT}`);
    });
  })
  .catch(err => {
    console.error('MongoDB connection error:', err);
    process.exit(1);
  });
```

### API Dockerfile.dev

```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

EXPOSE 4000

CMD ["npm", "run", "dev"]
```

### docker-compose.yml (starter)

```yaml
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:4000
    depends_on:
      - api

  api:
    # TODO: Complete this service

  mongo:
    # TODO: Complete this service

volumes:
  mongo-data:
```

## Testing Your Implementation

### 1. Start the Stack

```bash
docker compose up --build
```

### 2. Verify Services

```bash
# Check all containers are running
docker compose ps

# Check API health
curl http://localhost:4000/health

# Check frontend
open http://localhost:3000
```

### 3. Test CRUD Operations

```bash
# Create item
curl -X POST http://localhost:4000/api/items \
  -H "Content-Type: application/json" \
  -d '{"name": "Test Item", "description": "A test item"}'

# List items
curl http://localhost:4000/api/items

# Update item (replace {id} with actual ID)
curl -X PUT http://localhost:4000/api/items/{id} \
  -H "Content-Type: application/json" \
  -d '{"completed": true}'

# Delete item
curl -X DELETE http://localhost:4000/api/items/{id}
```

### 4. Test Hot Reload

1. Edit `api/src/server.js` - change a response message
2. Save the file
3. Verify the API restarts (check logs)
4. Test the changed endpoint

### 5. Test Persistence

```bash
# Add some items via the frontend
# Then restart the stack
docker compose down
docker compose up -d
# Verify items are still there
```

## Submission

1. Push your code to a **GitHub repository**
2. Ensure `.env` is in `.gitignore` (do NOT commit secrets)
3. Include `.env.example` with placeholder values
4. Submit the **repository URL** to the LMS

### Submission Checklist

- [ ] All files in correct structure
- [ ] docker-compose.yml works with `docker compose up --build`
- [ ] API endpoints work correctly
- [ ] Frontend displays and manages items
- [ ] Hot reload works for both services
- [ ] Data persists after restart
- [ ] README.md is complete with screenshots
- [ ] No secrets committed (`.env` in `.gitignore`)
- [ ] Code is clean and well-organized

## Grading Rubric

| Criteria | Points |
|----------|--------|
| Project structure correct | 10 |
| Docker Compose properly configured | 20 |
| API CRUD operations work | 20 |
| Frontend displays and manages items | 20 |
| Hot reload works | 10 |
| Data persistence works | 10 |
| Documentation complete | 10 |
| **Total** | **100** |

### Deductions

- -5 points: Late submission (per day)
- -10 points: Committed secrets (.env file)
- -5 points: Missing screenshots in README
- -5 points: Incomplete error handling

## Stretch Goals (Bonus Points)

For extra credit (up to 15 points):

1. **Input Validation** (+5) - Add validation to API endpoints
2. **Production Dockerfiles** (+5) - Create optimized production builds
3. **Loading States** (+3) - Add loading spinners/skeletons
4. **Error Boundaries** (+2) - Implement React error boundaries

## Resources

- [Docker Documentation](https://docs.docker.com/)
- [Docker Compose Reference](https://docs.docker.com/compose/compose-file/)
- [Express.js Guide](https://expressjs.com/en/guide/routing.html)
- [Mongoose Documentation](https://mongoosejs.com/docs/)
- [React Documentation](https://react.dev/)
- [Vite Documentation](https://vitejs.dev/)

## Getting Help

- **Office Hours:** Tuesday 9-11 AM, Pitt 2206
- **Piazza:** Post questions with `lab0` tag
- **TA Sessions:** Check LMS for schedule

::: {.callout-tip}
## Pro Tips
1. Start early - Docker can have unexpected setup issues
2. Read error messages carefully - they usually tell you what's wrong
3. Use `docker compose logs -f service_name` to debug specific services
4. Check that ports aren't already in use on your machine
5. If stuck, try `docker compose down -v` and rebuild
:::
